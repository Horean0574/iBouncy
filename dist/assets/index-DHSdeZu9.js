import{c as z,m as B,$ as C,w as D,K as g,g as x,_ as p,t as Y,M as U,h as N,W as f,F as A,f as k,Q as j,p as $}from"./leafer-BCB2pN9R.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();function W(){const o={rendered_:{value:!1,writable:!0,enumerable:!0,configurable:!0},w:{get(){return this.width},set(t){this.width=t},enumerable:!0,configurable:!0},h:{get(){return this.height},set(t){this.height=t},enumerable:!0,configurable:!0},ox:{get(){return this.x+this.width},set(t){this.x=t-this.width},enumerable:!0,configurable:!0},oy:{get(){return this.y+this.height},set(t){this.y=t-this.height},enumerable:!0,configurable:!0},cx:{get(){return this.x+this.width/2},set(t){this.x=t-this.width/2},enumerable:!0,configurable:!0},cy:{get(){return this.y+this.height/2},set(t){this.y=t-this.height/2},enumerable:!0,configurable:!0},lx:{get(){return this.x-this.width/2},set(t){this.x=t+this.width/2},enumerable:!0,configurable:!0},rx:{get(){return this.x+this.width/2},set(t){this.x=t-this.width/2},enumerable:!0,configurable:!0},ty:{get(){return this.y-this.height/2},set(t){this.y=t+this.height/2},enumerable:!0,configurable:!0},by:{get(){return this.y+this.height/2},set(t){this.y=t-this.height/2},enumerable:!0,configurable:!0},render_:{value:function(){this.rendered_||(c.add(this),this.rendered_=!0)},writable:!0,enumerable:!1,configurable:!0},cull_:{value:function(){this.rendered_&&(c.remove(this),this.rendered_=!1)},writable:!0,enumerable:!1,configurable:!0},show_:{value:function(){this.visible=!0},writable:!0,enumerable:!1,configurable:!0},hide_:{value:function(){this.visible=!1},writable:!0,enumerable:!1,configurable:!0},toggle_:{value:function(){this.visible=!this.visible},writable:!0,enumerable:!1,configurable:!0},fade_:{value:function(t,s,i,n=0){return this.animate([{opacity:t},{opacity:s}],{duration:i,delay:n})}},fadeTo_:{value:function(t,s,i=0){return this.animate([{opacity:t}],{duration:s,delay:i,join:!0})},writable:!0,enumerable:!1,configurable:!0},fadeIn_:{value:function(t,s=0){return this.fadeTo_(1,t,s)},writable:!0,enumerable:!1,configurable:!0},fadeOut_:{value:function(t,s=0){return this.fadeTo_(0,t,s)},writable:!0,enumerable:!1,configurable:!0}};Object.defineProperties(z.prototype,o)}class K{#t="init";measured=0;refreshRateBucket=new Map;constructor(t={}){this.ENV=t,this.gameOver=this.gameOver.bind(this)}get bw(){return document.body.clientWidth}get bh(){return document.body.clientHeight}state(t){this.#t=t}at(...t){for(let s of t)if(this.#t===s)return!0;return!1}async initializeAll(){await Promise.all([w.init(),_.init_(),y.init_()])}renderAll(){b.render_(),y.render_(),O.render_(),h.render_(),a.render_(),m.render_(),_.render_(),T.render_()}secondRender(){w.render_()}measureRefreshRate(t){if(this.measured>=20)return;const s=Math.round(60/t),i=this.refreshRateBucket.get(s);if(i===void 0?this.refreshRateBucket.set(s,1):this.refreshRateBucket.set(s,i+1),++this.measured>=20){let n=0,r=0;for(let[l,v]of this.refreshRateBucket.entries())v>=n&&(n=v,r=l);this.refreshRateBucket.clear(),e.ENV.refreshRate=r,e.ENV.fixedStep=1e3/r,e.ENV.actUnitInterval=(1e3/r).toFixed(1),e.state("init2")}}async fontInitializer(t,s){const i=new FontFace(t,`url(${s}.woff2)`);try{await i.load(),document.fonts.add(i),c.forceRender()}catch{const n=new FontFace(t,`url(${s}.woff)`);try{await n.load(),document.fonts.add(n),c.forceRender()}catch(r){console.error(r)}}}async ImageInitializer(t,s){let i=await B.origin.loadImage(s);C.setImage(`leafer://${t}`,i)}resetMain(t=!0){t&&d.hide_(),y.hide_(),m.reset_(),_.reset_(),h.reset_(),a.reset_()}mainMenu(){w.reset_(),this.resetMain(!1),(d.fill!=="#FFF"||d.opacity!==.4)&&(d.fill="#FFF",d.fadeTo_(.4,.5)),w.show_()}optionsMenu(){b.reset_(),(d.fill!=="#FFF"||d.opacity!==.4)&&(d.fill="#FFF",d.fadeTo_(.4,.5)),b.show_()}start(){d.hide_(),w.hide_()}pause(){this.at("paused","prepared","over")||this.#t.startsWith("init")||(this.state("paused"),u.pauseAll(),d.show_("#FFF",0,.4,.8),this.optionsMenu())}resume(){this.at("playing","prepared","over")||this.#t.startsWith("init")||(this.state("playing"),H(performance.now()),u.resumeAll(),d.hide_(),b.hide_())}gameOver(t=!1){return this.at("over")||(this.state("over"),m.stop_(),d.show_("#FFF",0,.4,.8),t?y.win_():y.fail_()),!0}loadingFadeOut(){L.animate([{opacity:0}],{duration:300,fill:"both"})}}class G{collisionStat=0;accelerateCD=50;prevAccelerateTime;borderDetect(t,{bounce:s=!1,paddings:i=[0,0,0,0],callbacks:n=[null,null,null,null]}={}){const r=s?-1:0;t.x<i[3]?n[3]?.()===void 0&&(t.x=i[3],t.vx*=r):t.ox>e.bw-i[1]&&n[1]?.()===void 0&&(t.ox=e.bw-i[1],t.vx*=r),t.y<i[0]?n[0]?.()===void 0&&(t.y=i[0],t.vy*=r):t.oy>e.bh-i[2]&&n[2]?.()===void 0&&(t.oy=e.bh-i[2],t.vy*=r)}collisionDetect(){if(!this.#t())return this.collisionStat=0,!1;if(this.collisionStat)return!1;this.collisionStat=1;const t=Math.min(a.ox,h.ox)-Math.max(a.x,h.x),s=Math.min(a.oy,h.oy)-Math.max(a.y,h.y),i=(a.vx^a.cx-h.cx)>0,n=(a.vy^a.cy-h.cy)>0;return i&&n?(a.x+=a.vx*1.5,a.y+=a.vy*1.5,a.vx*=this.tempAccelerate("x"),a.vy*=this.tempAccelerate("y")):n||t<s&&!i?(a.cx<h.cx?a.ox=h.x:a.x=h.ox,a.vx*=-this.tempAccelerate("x")):(a.cy<h.cy?a.oy=h.y:a.y=h.oy,a.vy*=-this.tempAccelerate("y")),!0}tempAccelerate(t){if(t!=="x"&&t!=="y")return 0;const s=performance.now();if(this.prevAccelerateTime!==void 0&&s-this.prevAccelerateTime<this.accelerateCD)return 1;this.prevAccelerateTime=s;const i="v"+t,n=t==="x"?1.5:1.2,r=t==="x"?.6:.25,l=n-Math.sign(a[i])*h[i]*r/h[i+"Max"],v=l**(1/6);return u.newInterval(()=>{a[i]/=v},16.7,{delay:200,executeTimes:6}),l}#t(){if(a.ox<h.x||a.x>h.ox||a.oy<h.y||a.y>h.oy)return!1;if(a.cx>=h.x&&a.cx<=h.ox||a.cy>=h.y&&a.cy<=h.oy)return!0;const t=a.cx-(a.cx<h.cx?h.x:h.ox),s=a.cy-(a.cy<h.cy?h.y:h.oy);return t*t+s*s<=a.w*a.w/4}}class X{constructor(){this.elements=new Map,this.head=0,this.tail=0}push(t){this.elements.set(this.tail,t),++this.tail}pop(){if(this.isEmpty)return null;const t=this.elements.get(this.head);return this.elements.delete(this.head),++this.head,t}front(){return this.elements.get(this.head)}clear(){this.elements.clear(),this.head=this.tail=0}get length(){return this.tail-this.head}get isEmpty(){return this.length===0}}class q{#t=new Map;#s=new Set;#e=new Map;#n=new Set;#r;#a=new X;#l=0;#d=0;#o=NaN;#c=0;#i={minInterval:16.7,autoHandleFPS:!1,FPSHandleInterval:33.3,FPSUpdateInterval:300};constructor(t={}){this.#i={...this.#i,...t},this.#i.autoHandleFPS&&this.initFPSHandler()}get MIN_INTERVAL(){return this.#i.minInterval}set MIN_INTERVAL(t){this.#i.minInterval=t}timeDetect(t){this.#f(t),this.#p(t)}#f(t){for(let s of this.#t.keys()){const i=this.#t.get(s);if(i.terminate){this.#s.add(s);continue}i.paused||t-i.start>=i.duration&&(this.#s.add(s),i.callback())}for(let s of this.#s)this.#t.delete(s);this.#s.clear()}#p(t){for(let s of this.#e.keys()){const i=this.#e.get(s);if(i.terminate){this.#n.add(s);continue}if(!i.paused&&!(t<i.start)&&(i.options.recFramesCnt&&++i.data.framesCnt,i.options.recElapsedTime&&(i.data.elapsed=t-i.start),t-i.step>=i.duration)){if(++i.data.cnt,i.callback(i.data),i.data.cnt>=i.options.executeTimes){this.#n.add(s);continue}i.step+=i.duration}}for(let s of this.#n)this.#e.delete(s);this.#n.clear()}newTimeout(t,s=this.#i.minInterval){s=Math.max(s,this.#i.minInterval);const i=Symbol("Timeout"),n=performance.now();let r={callback:t,start:n,pause:n,duration:s,paused:!1,terminate:!1};return this.#t.set(i,r),i}cancelTimeout(t){this.#t.get(t).terminate=!0}newInterval(t,s=this.#i.minInterval,i={}){i=Object.assign({delay:0,executeTimes:1/0,recFramesCnt:!1,recElapsedTime:!1},i),s=Math.max(s,this.#i.minInterval);const n=Symbol("Interval"),r=performance.now();let l={callback:t,start:r+i.delay,step:r+i.delay,pause:r+i.delay,duration:s,paused:!1,terminate:!1,options:i,data:{cnt:0,framesCnt:0,elapsed:0}};return this.#e.set(n,l),n}cancelInterval(t){this.#e.get(t).terminate=!0}pause(t){const s=this.#u(t);if(s==="Timeout"){const i=this.#t.get(t);if(i.paused)return;i.paused=!0,i.pause=performance.now()}else if(s==="Interval"){const i=this.#e.get(t);if(i.paused)return;i.paused=!0,i.pause=performance.now()}}resume(t){const s=this.#u(t);if(s==="Timeout"){const i=this.#t.get(t);if(!i.paused)return;i.paused=!1,i.start+=performance.now()-i.pause}else if(s==="Interval"){const i=this.#e.get(t);if(!i.paused)return;i.paused=!1,i.step+=performance.now()-i.pause}}pauseAll(){for(let t of this.#t.keys())this.pause(t);for(let t of this.#e.keys())this.pause(t)}resumeAll(){for(let t of this.#t.keys())this.resume(t);for(let t of this.#e.keys())this.resume(t)}#u(t){const s=t.toString();return s.substring(7,s.length-1)}initFPSHandler(){this.#h()||(this.#r=this.newInterval(t=>{for(this.#a.push([t.elapsed,t.framesCnt]);t.elapsed-this.#a.front()[0]>1e3;)this.#a.pop();this.#l=t.framesCnt,this.#d=t.elapsed},this.#i.FPSHandleInterval,{recFramesCnt:!0,recElapsedTime:!0}))}destroyFPSHandler(){this.#h()&&(this.cancelInterval(this.#r),this.#r=null,this.#a.clear())}#h(){return this.#r!==void 0&&this.#r!==null}#m(){const t=this.#l-this.#a.front()[1],s=1e3/(this.#d-this.#a.front()[0]);return(t*s).toFixed(1)}get FPS(){if(!this.#h()||this.#a.isEmpty)return this.#o=NaN;const t=performance.now();return t-this.#c<this.#i.FPSUpdateInterval?this.#o:(this.#c=t,this.#o=this.#m())}}class Z extends D{#t={fill:"#FFF",opacity:.6,fadeInDuration:.8};constructor(){super({x:0,y:0,width:e.bw,height:e.bh,fill:"#666",visible:!1,zIndex:990}),this.fill=this.#t.fill,this.animation={style:{opacity:this.#t.opacity},duration:this.#t.fadeInDuration,join:!0}}relocate_(t){this.w=t.width,this.h=t.height}show_(t=this.#t.fill,s=0,i=this.#t.opacity,n=this.#t.fadeInDuration){this.visible=!0,this.relocate_({width:e.bw,height:e.bh}),this.fill=t,this.fade_(s,i,n)}hide_(){this.fadeOut_(.5).once(g.COMPLETED,()=>this.visible=!1)}}class F extends x{$defFill;$defSize;$defWeight;$cnt=-1;constructor(t,s,i="center",n="#000",r=16,l="normal"){super({x:t,y:s,around:i}),this.$defFill=n,this.$defSize=r,this.$defWeight=l}#t(t,s,i,n,r){this.add(new p({x:++this.$cnt?this.children[this.$cnt-1].ox+s:0,y:0,text:t,fill:i===void 0?this.$defFill:i,fontSize:n===void 0?this.$defSize:n,fontWeight:r===void 0?this.$defWeight:r}))}$add(t,s=3,i,n,r){return this.#t(t,s,i,n,r),this.children[this.$cnt]}$append(t,s=3,i,n,r){return this.#t(t,s,i,n,r),this}}class Q extends x{constructor(){super({x:0,y:0,width:e.bw,height:e.bh,visible:!1,zIndex:991}),this.Brand=new Y({x:e.bw/2,y:e.bh*2/7,around:"center",url:"leafer://brand.svg",opacity:0,scale:0,offsetY:-300,shadow:{x:0,y:0,blur:50,color:"#555"}}),this.Hint1=new F(e.bw/2,e.bh*4/7-12,"center","#444",16).$append("按").$append("空格键",3,void 0,void 0,"bold").$append("开始游戏"),this.Hint1.opacity=0,this.Hint2=new F(e.bw/2,e.bh*4/7+12,"center","#777",12).$append("通过").$append("方向键",3,void 0,void 0,"bold").$append("或").$append("W/A/S/D",3,void 0,void 0,"bold").$append("来控制平板的移动"),this.Hint2.opacity=0,this.add([this.Brand,this.Hint1,this.Hint2])}async init(){await this.preloadImage()}async preloadImage(){await e.ImageInitializer("brand.svg","./assets/svg/brand.svg")}relocate_(t){this.cx=t.width/2,this.Brand.y=t.height*2/7,this.Hint1.y=t.height*4/7-12,this.Hint2.y=t.height*4/7+12}reset_(){this.opacity=1,this.Brand.opacity=0,this.Brand.scale=0,this.Brand.offsetY=-300,this.Hint1.opacity=0,this.Hint2.opacity=0}show_(){this.visible=!0,this.relocate_({width:e.bw,height:e.bh}),this.Brand.animate([{opacity:.9,scale:1.1,offsetY:-5},{opacity:1,scale:1,offsetY:0}],{duration:.8,join:!0}).once(g.COMPLETED,()=>{this.Brand.hoverStyle={shadow:{x:0,y:0,blur:20,color:"#FFEF00"}}}),this.Hint1.fadeIn_(.8,.2),this.Hint2.fadeIn_(.8,.4)}hide_(){this.fadeOut_(.5).once(g.COMPLETED,()=>this.visible=!1)}}class J extends x{constructor(){super({x:0,y:0,width:e.bw,height:e.bh,visible:!1,zIndex:991}),this.Title=new p({x:e.bw/2,y:e.bh*2/7,around:"center",text:"游戏已暂停",fontSize:32,fontWeight:"bold"}),this.Hint1=new F(e.bw/2,e.bh*4/7-12,"center","#444",16).$append("按").$append("空格键",3,void 0,void 0,"bold").$append("继续游戏"),this.Hint1.opacity=0,this.Hint2=new F(e.bw/2,e.bh*4/7+12,"center","#777",12).$append("按").$append("回车键",3,void 0,void 0,"bold").$append("结束游戏并返回开始菜单"),this.Hint2.opacity=0,this.add([this.Title,this.Hint1,this.Hint2])}relocate_(t){this.cx=t.width/2,this.Hint1.y=t.height*4/7-12,this.Hint2.y=t.height*4/7+12}reset_(){this.opacity=1,this.Title.opacity=0,this.Hint1.opacity=0,this.Hint2.opacity=0}show_(){this.visible=!0,this.relocate_({width:e.bw,height:e.bh}),this.Title.fadeIn_(.4),this.Hint1.fadeIn_(.8,.2),this.Hint2.fadeIn_(.8,.4)}hide_(){this.fadeOut_(.5).once(g.COMPLETED,()=>this.visible=!1)}}class tt extends x{constructor(){super({x:0,y:0,width:e.bw,height:e.bh,visible:!1,zIndex:991}),this.Title=new p({x:e.bw/2,y:e.bh*2/7,around:"center",text:"",fontSize:108,fontFamily:"HYBeiBingYang-W",scale:.5,opacity:0}),this.Hint1=new F(e.bw/2,e.bh*9/14-12,"center","#444",16).$append("按").$append("空格键",3,void 0,void 0,"bold").$append("重新开始"),this.Hint1.opacity=0,this.Hint2=new F(e.bw/2,e.bh*9/14+12,"center","#777",12).$append("按").$append("回车键",3,void 0,void 0,"bold").$append("返回开始菜单"),this.Hint2.opacity=0,this.add([this.Title,this.Hint1,this.Hint2]),this.init_=this.init_.bind(this)}relocate_(t){this.Title.x=t.width/2,this.Title.y=t.height*2/7}async init_(){await Promise.all([this.#t(),this.#s()])}async#t(){await e.fontInitializer("HYBeiBingYang-W","./assets/fonts/HYBeiBingYang-W")}async#s(){await Promise.all([e.ImageInitializer("GL.jpg","./assets/img/GL.jpg"),e.ImageInitializer("DL.jpg","./assets/img/DL.jpg")])}show_(){this.visible=!0,this.relocate_({width:e.bw,height:e.bh}),this.Title.animate([{scale:1,opacity:1}],{duration:.4,join:!0}),this.Hint1.fadeIn_(.8,.2),this.Hint2.fadeIn_(.8,.4)}hide_(){this.Title.animate([{scale:.3,opacity:0}],{duration:.3,join:!0}),this.Hint1.fadeOut_(.5),this.Hint2.fadeOut_(.5).once(g.COMPLETED,()=>this.visible=!1)}win_(){this.Title.text=" You Win! ",this.#e("leafer://GL.jpg",75),this.#n("#FFEF00"),this.show_()}fail_(){this.Title.text=" FAIL ",this.#e("leafer://DL.jpg",-50),this.#n("#474746"),this.show_()}#e(t,s){this.Title.fill={type:"image",url:t,offset:{y:s}}}#n(t){this.Title.shadow={x:0,y:0,blur:25,spread:15,color:t}}}class et extends p{constructor(){super({x:12,y:e.bh-24,fontSize:12,fill:"#777",text:"FPS: --"})}relocate_(t){t.height!==t.old.height&&(this.y=t.height-24)}assign_(t){isNaN(t)&&(t="--"),this.text="FPS: "+t}}class it extends U{constructor(){super({points:[0,e.bh,0,0,e.bw,0,e.bw,e.bh,e.bw-e.ENV.paddingSide,e.bh,e.bw-e.ENV.paddingSide,e.ENV.paddingTop,e.ENV.paddingSide,e.ENV.paddingTop,e.ENV.paddingSide,e.bh],fill:"#E85B5B87"})}relocate_(t){this.points=[0,t.height,0,0,t.width,0,t.width,t.height,t.width-e.ENV.paddingSide,t.height,t.width-e.ENV.paddingSide,e.ENV.paddingTop,e.ENV.paddingSide,e.ENV.paddingTop,e.ENV.paddingSide,t.height]}}class M extends x{alarm;remaining=e.ENV.timeLimit;animatingFlag=!1;constructor(){super({x:15,y:15}),this.Icon=new N({path:"M511.488 0C228.864 0 0 229.376 0 512s228.864 512 511.488 512C794.624 1024 1024 794.624 1024 512s-229.376-512-512.512-512z m21.76 556.416V219.52H438.912v392.32h1.472l243.84 140.8 47.296-81.728-198.144-114.432zM512 921.6A409.472 409.472 0 0 1 102.4 512c0-226.304 183.296-409.6 409.6-409.6 226.304 0 409.6 183.296 409.6 409.6 0 226.304-183.296 409.6-409.6 409.6z",x:0,y:0,scale:.015625,fill:"#262626"}),this.IconG=new x({x:0,y:0,width:16,height:16,origin:"center",children:[this.Icon]}),this.Text=new p({x:20,y:0,fontSize:16,lineHeight:16,text:"3:00",fill:"#262626"}),this.add([this.IconG,this.Text])}reset_(){this.remaining=e.ENV.timeLimit,this.animatingFlag=!1,this.Text.text=M.toMSString_(e.ENV.timeLimit),this.Text.fontWeight="normal",this.Text.fill=this.Icon.fill="#262626"}start_(){this.alarm=u.newInterval(this.#t.bind(this),1e3)}stop_(){u.cancelInterval(this.alarm),this.animatingFlag&&(this.animatingFlag=!1,this.IconG.killAnimate())}static toMS_(t){return[I(t/60),t%60]}static toMSString_(t){const s=t%60;return`${I(t/60)}:${s<10?"0"+s:s}`}#t(){--this.remaining<0||(this.Text.text=M.toMSString_(this.remaining),!this.animatingFlag&&this.remaining<=15&&(this.animatingFlag=!0,this.IconG.animate([{style:{rotation:35,y:0},duration:.1},{style:{rotation:-35,y:-3},duration:.1},{style:{rotation:25,y:-3},duration:.1},{style:{rotation:-25,y:0},duration:.1}],{loop:!0,loopDelay:.6,join:!0}),this.Icon.fill=this.Text.fill="#44C2F1",this.Text.fontWeight="bold"),this.remaining<=0&&e.gameOver(!0))}}class E extends x{v=0;constructor(){super({x:e.bw/2-120,y:0}),this.Panel=new N({path:`m -120 0
  h 10
  a 20 15 0 0 1 20 15
  v 35
  a 15 18 0 0 0 15 18
  h 150
  a 15 18 0 0 0 15 -18
  v -35
  a 20 15 0 0 1 20 -15
  h 10
  Z`,x:120,y:0,fill:"#777A"}),this.Integer=new p({x:-e.bw,y:7,fontSize:40,fill:"#FFF",text:"-",fontFamily:"HYDiSiKe-U"}),this.Decimal=new p({x:-e.bw,y:15,fontSize:32,fill:"#DDD",text:"--",fontFamily:"HYDiSiKe-U"}),this.add([this.Panel,this.Integer,this.Decimal]),this.init_=this.init_.bind(this)}reset_(){this.assign_(0)}relocate_(t){t.width!==t.old.width&&(this.cx=t.width/2,this.#e())}async init_(){await this.#t()}async#t(){await e.fontInitializer("HYDiSiKe-U","./assets/fonts/HYDiSiKe-U"),this.#e()}assign_(t){return this.v=Math.round(t*10),this.#e(),E.stringify_(this.v)}delta_(t){const s=this.v;return this.v+=Math.round(t*10),this.#e(),E.stringify_(this.v-s)}tip_(t){const[s,i,n]=this.#s(),r=new p({x:a.cx+s,y:a.oy,around:"center",text:"+"+t,fill:"#FFEF00",stroke:"#33333333",fontSize:20,fontFamily:"HYDiSiKe-U",opacity:.9,shadow:{x:1,y:1,blur:10,color:"gray"},animation:{keyframes:[{style:{opacity:.9,fontSize:24},duration:.3},{style:{opacity:0,fontSize:25},duration:.4}],join:!0}});r.render_(),r.animate([{offsetX:i}],{duration:.45,easing:"sine-out",join:!0}),r.animate([{style:{offsetY:-12},duration:.12,easing:"quad-out"},{style:{offsetY:n},duration:.28,easing:"quad-in-out"}],{join:!0}),u.newTimeout(function(){r.destroy()},600)}#s(){const t=.7*a.vx*600/e.ENV.actUnitInterval;let s=Math.random()>=.5?1:-1,i=(10+Math.random()*20)*s,n=(40+Math.random()*20)*s,r=(Math.random()-.4)*24;const l=i+n+t;return(a.cx+l<=e.ENV.paddingSide||a.cx+l>=e.bw-e.ENV.paddingSide)&&(i*=-1,n*=-1),[i+t/2,n+t/2,r]}#e(){this.Integer.text=I(this.v/10),this.Decimal.text="."+this.v%10,this.Integer.x=(240-this.Integer.w-this.Decimal.w)/2,this.Decimal.x=this.Integer.ox}static stringify_(t){return`${I(t/10)}.${t%10}`}}class st extends D{vxMax;vyMax;vx;vy;availZone=[80,40,0,40];constructor(){super({width:120,height:25,fill:"#32CD79"})}reset_(){this.vxMax=6,this.vyMax=2.8,this.vx=0,this.vy=0,this.cx=e.bw/2,this.y=e.bh-140}frameLoop(t){this.vx=this.vy=0,(f.isHold("KeyW")||f.isHold("ArrowUp"))&&(this.vy-=this.vyMax*t),(f.isHold("KeyS")||f.isHold("ArrowDown"))&&(this.vy+=this.vyMax*t),(f.isHold("KeyA")||f.isHold("ArrowLeft"))&&(this.vx-=this.vxMax*t),(f.isHold("KeyD")||f.isHold("ArrowRight"))&&(this.vx+=this.vxMax*t),this.x+=this.vx,this.y+=this.vy,P.borderDetect(h,{paddings:this.availZone})}}class nt{length=8;dotRadius=5.5;loopIdx=0;dotIdx=-1;dots=new Map;activeAnimations=new Map;framesInterval=5;constructor(){for(let t=0;t<this.length;++t)this.dots.set(t,new A({x:-100,y:-100,width:this.dotRadius*2,height:this.dotRadius*2,around:"center",fill:"#FF4500BA",visible:!1}))}render(){for(let t of this.dots.values())t.render_()}prepare(){e.ENV.actUnitInterval>=25?this.framesInterval=ot(94/e.ENV.actUnitInterval):this.framesInterval=I(94/e.ENV.actUnitInterval)}frameLoop(t){if(this.loopIdx=(this.loopIdx+1)%this.framesInterval,this.loopIdx===0){const s=this.dotIdx=(this.dotIdx+1)%this.length,i=this.dots.get(s);if(i.w=i.h=this.dotRadius*2,i.opacity=1,i.x=a.cx,i.y=a.cy,i.visible=!0,this.activeAnimations.has(s)){const r=this.activeAnimations.get(s);r.off(g.COMPLETED),c.killAnimate(r),this.activeAnimations.delete(s)}const n=i.animate([{opacity:1,width:this.dotRadius*2,height:this.dotRadius*2},{opacity:.3,width:5,height:5}],{duration:e.ENV.stdUnitInterval*this.framesInterval*this.length/t/1e3,easing:"linear"});n.on(g.COMPLETED,()=>{this.activeAnimations.delete(s),i.visible=!1,i.w=i.h=this.dotRadius*2,i.opacity=1}),this.activeAnimations.set(s,n)}}}class at extends A{vx;ax;ay;timeDivisor=1;constructor(){super({width:20,height:20,fill:"#20A8D7"}),this.trailing=new nt}reset_(){this.vx=(Math.random()*1.9+1.6)*(Math.random()>.5?1:-1),this.vy=3.5,this.ax=127e-6,this.ay=143e-6,this.cx=e.bw/2,this.cy=e.bh/4}render_(){this.trailing.render(),c.add(this)}prepare_(){this.trailing.prepare()}frameLoop_(t){m.remaining>=70&&m.remaining<160&&(this.vx*=(1+this.ax)**t,this.vy*=(1+this.ay)**t,this.ax*=.99987,this.ay*=.99987),this.x+=this.vx*t,this.y+=this.vy*t,P.borderDetect(this,{bounce:!0,paddings:[0,0,-this.h*3,0],callbacks:[null,null,e.gameOver,null]}),this.trailing.frameLoop(this.timeDivisor)}}const rt=Math.abs,ot=Math.ceil,I=Math.floor;let V;function H(o){V=o}const L=document.querySelector("#loading");W();const c=new k({view:document.querySelector("canvas"),fill:"#EFF",pointer:{preventDefaultMenu:!0}}),e=new K({refreshRate:60,actUnitInterval:16.7,stdUnitInterval:16.7,fixedStep:16.7,maxStepPerFrame:10,paddingTop:80,paddingSide:40,timeLimit:180}),P=new G,u=new q({minInterval:0,autoHandleFPS:!0}),d=new Z,w=new Q,b=new J,y=new tt,T=new et,O=new it,m=new M,_=new E,h=new st,a=new at;L.addEventListener("dragstart",o=>o.preventDefault());let S=0;d.render_();d.show_("#FFF",1,.7,.4);ht();e.renderAll();requestAnimationFrame(lt);u.newInterval(()=>T.assign_(u.FPS),400);e.initializeAll().then(e.secondRender).then(()=>e.state("init1")).catch(o=>console.error(`Initialization failed...
`,o));function ht(){m.reset_(),h.reset_(),a.reset_()}function lt(o){H(o),R(o)}function R(o){const t=o-V;H(o),u.timeDetect(o),e.at("init1")?e.measureRefreshRate(t/e.ENV.stdUnitInterval):e.at("init2")?(a.prepare_(),e.state("almost-prepared")):e.at("almost-prepared")&&(e.state("prepared"),e.loadingFadeOut(),e.mainMenu());let s=1;if(e.at("playing"))for(S+=Math.min(t,500),a.timeDivisor=Math.min(I(S/e.ENV.fixedStep),e.ENV.maxStepPerFrame);S>=e.ENV.fixedStep&&s<=e.ENV.maxStepPerFrame;){S-=e.ENV.fixedStep,++s;const i=e.ENV.fixedStep/e.ENV.stdUnitInterval;if(a.frameLoop_(i),h.frameLoop(i),P.collisionDetect()&&a.vy<0){const n=Math.sqrt(a.vx**2+a.vy**2),r=Math.log2(n)+1/Math.cos(Math.PI/20*n),l=rt(h.cx-a.cx),v=Math.cos(Math.PI/h.w*2*l)+.5;_.tip_(_.delta_(.4*r+.16*v))}}requestAnimationFrame(R)}document.addEventListener("visibilitychange",function(){document.hidden&&e.pause()});c.on(j.RESIZE,function(o){d.relocate_(o),w.relocate_(o),b.relocate_(o),y.relocate_(o),T.relocate_(o),O.relocate_(o),_.relocate_(o)});c.on($.HOLD,function(o){o.code==="Semicolon"&&T.toggle_()});c.on($.UP,function(o){switch(o.code){case"Space":e.at("prepared")?(e.state("playing"),m.start_(),e.start()):e.at("over")?(e.resetMain(),e.state("playing"),m.start_()):e.at("paused")&&e.resume();break;case"Enter":e.at("over")?(e.state("prepared"),y.hide_(),e.mainMenu()):e.at("paused")&&(e.state("prepared"),b.hide_(),e.mainMenu());break}});
//# sourceMappingURL=index-DHSdeZu9.js.map
