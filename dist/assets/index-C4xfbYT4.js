import{c as z,m as B,$ as j,w as P,g as w,_ as y,t as C,K as _,M as O,h as D,W as u,F as N,f as Y,Q as U,p as A}from"./leafer-BCB2pN9R.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();function k(){const o={w:{get(){return this.width},set(t){this.width=t},enumerable:!0,configurable:!0},h:{get(){return this.height},set(t){this.height=t},enumerable:!0,configurable:!0},ox:{get(){return this.x+this.width},set(t){this.x=t-this.width},enumerable:!0,configurable:!0},oy:{get(){return this.y+this.height},set(t){this.y=t-this.height},enumerable:!0,configurable:!0},cx:{get(){return this.x+this.width/2},set(t){this.x=t-this.width/2},enumerable:!0,configurable:!0},cy:{get(){return this.y+this.height/2},set(t){this.y=t-this.height/2},enumerable:!0,configurable:!0},lx:{get(){return this.x-this.width/2},set(t){this.x=t+this.width/2},enumerable:!0,configurable:!0},rx:{get(){return this.x+this.width/2},set(t){this.x=t-this.width/2},enumerable:!0,configurable:!0},ty:{get(){return this.y-this.height/2},set(t){this.y=t+this.height/2},enumerable:!0,configurable:!0},by:{get(){return this.y+this.height/2},set(t){this.y=t-this.height/2},enumerable:!0,configurable:!0},render_:{value:function(){d.add(this)},writable:!0,enumerable:!1,configurable:!0},cull_:{value:function(){d.remove(this)},writable:!0,enumerable:!1,configurable:!0},show_:{value:function(){this.visible=!0},writable:!0,enumerable:!1,configurable:!0},hide_:{value:function(){this.visible=!1},writable:!0,enumerable:!1,configurable:!0},toggle_:{value:function(){this.visible=!this.visible},writable:!0,enumerable:!1,configurable:!0}};Object.defineProperties(z.prototype,o)}class W{#t="init";measured=0;refreshRateBucket=new Map;constructor(t={}){this.ENV=t,this.gameOver=this.gameOver.bind(this)}get bw(){return document.body.clientWidth}get bh(){return document.body.clientHeight}state(t){this.#t=t}at(...t){for(let s of t)if(this.#t===s)return!0;return!1}async initializeAll(){await Promise.all([x.init(),v.init_(),p.init_()])}renderAll(){p.render_(),L.render_(),h.render_(),a.render_(),m.render_(),v.render_(),M.render_()}measureRefreshRate(t){if(this.measured>=20)return;const s=Math.round(60/t),e=this.refreshRateBucket.get(s);if(e===void 0?this.refreshRateBucket.set(s,1):this.refreshRateBucket.set(s,e+1),++this.measured>=20){let n=0,r=0;for(let[l,g]of this.refreshRateBucket.entries())g>=n&&(n=g,r=l);this.refreshRateBucket.clear(),i.ENV.refreshRate=r,i.ENV.fixedStep=1e3/r,i.ENV.actUnitInterval=(1e3/r).toFixed(1),i.state("init2")}}async fontInitializer(t,s){const e=new FontFace(t,`url(${s}.woff2)`);try{await e.load(),document.fonts.add(e),d.forceRender()}catch{const n=new FontFace(t,`url(${s}.woff)`);try{await n.load(),document.fonts.add(n),d.forceRender()}catch(r){console.error(r)}}}async ImageInitializer(t,s){let e=await B.origin.loadImage(s);j.setImage(`leafer://${t}`,e)}resetMain(t=!0){t&&f.cull_(),p.hide_(),m.reset_(),v.reset_(),h.reset_(),a.reset_()}menu(t=!0){t?x.reset_():x.render_(),this.resetMain(!1),(f.fill!=="#FFF"||f.opacity!==.4)&&f.animate([{fill:"#FFF",opacity:.4}],{duration:.5,join:!0}),x.show_()}start(){f.cull_(),x.hide_()}pause(){this.at("paused","prepared","over")||this.#t.startsWith("init")||(this.state("paused"),c.pauseAll())}resume(){this.at("playing","prepared","over")||this.#t.startsWith("init")||(this.state("playing"),T(performance.now()),c.resumeAll())}gameOver(t=!1){return this.at("over")||(this.state("over"),m.stop_(),f.render_("#FFF",0,.4,.8),t?p.win_():p.fail_()),!0}loadingFadeOut(){$.animate([{opacity:0}],{duration:300,fill:"both"})}}class K{collisionStat=0;accelerateCD=50;prevAccelerateTime;borderDetect(t,{bounce:s=!1,paddings:e=[0,0,0,0],callbacks:n=[null,null,null,null]}={}){const r=s?-1:0;t.x<e[3]?n[3]?.()===void 0&&(t.x=e[3],t.vx*=r):t.ox>i.bw-e[1]&&n[1]?.()===void 0&&(t.ox=i.bw-e[1],t.vx*=r),t.y<e[0]?n[0]?.()===void 0&&(t.y=e[0],t.vy*=r):t.oy>i.bh-e[2]&&n[2]?.()===void 0&&(t.oy=i.bh-e[2],t.vy*=r)}collisionDetect(){if(!this.#t())return this.collisionStat=0,!1;if(this.collisionStat)return!1;this.collisionStat=1;const t=Math.min(a.ox,h.ox)-Math.max(a.x,h.x),s=Math.min(a.oy,h.oy)-Math.max(a.y,h.y),e=(a.vx^a.cx-h.cx)>0,n=(a.vy^a.cy-h.cy)>0;return e&&n?(a.x+=a.vx*1.5,a.y+=a.vy*1.5,a.vx*=this.tempAccelerate("x"),a.vy*=this.tempAccelerate("y")):n||t<s&&!e?(a.cx<h.cx?a.ox=h.x:a.x=h.ox,a.vx*=-this.tempAccelerate("x")):(a.cy<h.cy?a.oy=h.y:a.y=h.oy,a.vy*=-this.tempAccelerate("y")),!0}tempAccelerate(t){if(t!=="x"&&t!=="y")return 0;const s=performance.now();if(this.prevAccelerateTime!==void 0&&s-this.prevAccelerateTime<this.accelerateCD)return 1;this.prevAccelerateTime=s;const e="v"+t,n=t==="x"?1.5:1.2,r=t==="x"?.6:.25,l=n-Math.sign(a[e])*h[e]*r/h[e+"Max"],g=l**(1/6);return c.newInterval(()=>{a[e]/=g},16.7,{delay:200,executeTimes:6}),l}#t(){if(a.ox<h.x||a.x>h.ox||a.oy<h.y||a.y>h.oy)return!1;if(a.cx>=h.x&&a.cx<=h.ox||a.cy>=h.y&&a.cy<=h.oy)return!0;const t=a.cx-(a.cx<h.cx?h.x:h.ox),s=a.cy-(a.cy<h.cy?h.y:h.oy);return t*t+s*s<=a.w*a.w/4}}class G{constructor(){this.elements=new Map,this.head=0,this.tail=0}push(t){this.elements.set(this.tail,t),++this.tail}pop(){if(this.isEmpty)return null;const t=this.elements.get(this.head);return this.elements.delete(this.head),++this.head,t}front(){return this.elements.get(this.head)}clear(){this.elements.clear(),this.head=this.tail=0}get length(){return this.tail-this.head}get isEmpty(){return this.length===0}}class X{#t=new Map;#s=new Set;#e=new Map;#n=new Set;#r;#a=new G;#l=0;#d=0;#o=NaN;#c=0;#i={minInterval:16.7,autoHandleFPS:!1,FPSHandleInterval:33.3,FPSUpdateInterval:300};constructor(t={}){this.#i={...this.#i,...t},this.#i.autoHandleFPS&&this.initFPSHandler()}get MIN_INTERVAL(){return this.#i.minInterval}set MIN_INTERVAL(t){this.#i.minInterval=t}timeDetect(t){this.#f(t),this.#m(t)}#f(t){for(let s of this.#t.keys()){const e=this.#t.get(s);if(e.terminate){this.#s.add(s);continue}e.paused||t-e.start>=e.duration&&(this.#s.add(s),e.callback())}for(let s of this.#s)this.#t.delete(s);this.#s.clear()}#m(t){for(let s of this.#e.keys()){const e=this.#e.get(s);if(e.terminate){this.#n.add(s);continue}if(!e.paused&&!(t<e.start)&&(e.options.recFramesCnt&&++e.data.framesCnt,e.options.recElapsedTime&&(e.data.elapsed=t-e.start),t-e.step>=e.duration)){if(++e.data.cnt,e.callback(e.data),e.data.cnt>=e.options.executeTimes){this.#n.add(s);continue}e.step+=e.duration}}for(let s of this.#n)this.#e.delete(s);this.#n.clear()}newTimeout(t,s=this.#i.minInterval){s=Math.max(s,this.#i.minInterval);const e=Symbol("Timeout"),n=performance.now();let r={callback:t,start:n,pause:n,duration:s,paused:!1,terminate:!1};return this.#t.set(e,r),e}cancelTimeout(t){this.#t.get(t).terminate=!0}newInterval(t,s=this.#i.minInterval,e={}){e=Object.assign({delay:0,executeTimes:1/0,recFramesCnt:!1,recElapsedTime:!1},e),s=Math.max(s,this.#i.minInterval);const n=Symbol("Interval"),r=performance.now();let l={callback:t,start:r+e.delay,step:r+e.delay,pause:r+e.delay,duration:s,paused:!1,terminate:!1,options:e,data:{cnt:0,framesCnt:0,elapsed:0}};return this.#e.set(n,l),n}cancelInterval(t){this.#e.get(t).terminate=!0}pause(t){const s=this.#u(t);if(s==="Timeout"){const e=this.#t.get(t);if(e.paused)return;e.paused=!0,e.pause=performance.now()}else if(s==="Interval"){const e=this.#e.get(t);if(e.paused)return;e.paused=!0,e.pause=performance.now()}}resume(t){const s=this.#u(t);if(s==="Timeout"){const e=this.#t.get(t);if(!e.paused)return;e.paused=!1,e.start+=performance.now()-e.pause}else if(s==="Interval"){const e=this.#e.get(t);if(!e.paused)return;e.paused=!1,e.step+=performance.now()-e.pause}}pauseAll(){for(let t of this.#t.keys())this.pause(t);for(let t of this.#e.keys())this.pause(t)}resumeAll(){for(let t of this.#t.keys())this.resume(t);for(let t of this.#e.keys())this.resume(t)}#u(t){const s=t.toString();return s.substring(7,s.length-1)}initFPSHandler(){this.#h()||(this.#r=this.newInterval(t=>{for(this.#a.push([t.elapsed,t.framesCnt]);t.elapsed-this.#a.front()[0]>1e3;)this.#a.pop();this.#l=t.framesCnt,this.#d=t.elapsed},this.#i.FPSHandleInterval,{recFramesCnt:!0,recElapsedTime:!0}))}destroyFPSHandler(){this.#h()&&(this.cancelInterval(this.#r),this.#r=null,this.#a.clear())}#h(){return this.#r!==void 0&&this.#r!==null}#p(){const t=this.#l-this.#a.front()[1],s=1e3/(this.#d-this.#a.front()[0]);return(t*s).toFixed(1)}get FPS(){if(!this.#h()||this.#a.isEmpty)return this.#o=NaN;const t=performance.now();return t-this.#c<this.#i.FPSUpdateInterval?this.#o:(this.#c=t,this.#o=this.#p())}}class q extends P{#t={fill:"#666",opacity:.6,fadeInDuration:.8};constructor(){super({x:0,y:0,width:i.bw,height:i.bh,fill:"#666",opacity:0,animationOut:{style:{opacity:0},duration:.5,join:!0},zIndex:990}),this.fill=this.#t.fill,this.animation={style:{opacity:this.#t.opacity},duration:this.#t.fadeInDuration,join:!0}}relocate_(t){this.w=t.width,this.h=t.height}render_(t=void 0,s=void 0,e=void 0,n=void 0){t===void 0?this.fill=this.#t.fill:this.fill=t,s===void 0?this.opacity=0:this.opacity=s,e===void 0?this.animation.style.opacity=this.#t.opacity:this.animation.style.opacity=e,n===void 0?this.animation.duration=this.#t.fadeInDuration:this.animation.duration=n,d.add(this)}}class I extends w{$defFill;$defSize;$defWeight;$cnt=-1;constructor(t,s,e="center",n="#000",r=16,l="normal"){super({x:t,y:s,around:e}),this.$defFill=n,this.$defSize=r,this.$defWeight=l}#t(t,s,e,n,r){this.add(new y({x:++this.$cnt?this.children[this.$cnt-1].ox+s:0,y:0,text:t,fill:e===void 0?this.$defFill:e,fontSize:n===void 0?this.$defSize:n,fontWeight:r===void 0?this.$defWeight:r}))}$add(t,s=3,e,n,r){return this.#t(t,s,e,n,r),this.children[this.$cnt]}$append(t,s=3,e,n,r){return this.#t(t,s,e,n,r),this}}class Z extends w{constructor(){super({x:0,y:0,width:i.bw,height:i.bh,zIndex:991}),this.Brand=new C({x:i.bw/2,y:i.bh*2/7,around:"center",url:"leafer://brand.svg",opacity:0,scale:0,offsetY:-300,shadow:{x:0,y:0,blur:50,color:"#555"}}),this.Hint1=new I(i.bw/2,i.bh*4/7-12,"center","#444",16).$append("按").$append("空格键",3,void 0,void 0,"bold").$append("开始游戏"),this.Hint1.opacity=0,this.Hint2=new I(i.bw/2,i.bh*4/7+12,"center","#777",12).$append("通过").$append("方向键",3,void 0,void 0,"bold").$append("或").$append("W/A/S/D",3,void 0,void 0,"bold").$append("来控制平板的移动"),this.Hint2.opacity=0,this.add([this.Brand,this.Hint1,this.Hint2])}async init(){await this.preloadImage()}async preloadImage(){await i.ImageInitializer("brand.svg","./assets/svg/brand.svg")}relocate_(t){this.cx=t.width/2,this.Brand.y=t.height*2/7,this.Hint1.y=t.height*4/7-12,this.Hint2.y=t.height*4/7+12}reset_(){this.opacity=1,this.x=this.y=0,this.Brand.opacity=0,this.Brand.scale=0,this.Brand.offsetY=-300,this.Hint1.opacity=0,this.Hint2.opacity=0}show_(){this.visible=!0,this.relocate_({width:i.bw,height:i.bh}),this.Brand.animate([{opacity:.9,scale:1.1,offsetY:-5},{opacity:1,scale:1,offsetY:0}],{duration:.8,join:!0}).once(_.COMPLETED,()=>{this.Brand.hoverStyle={shadow:{x:0,y:0,blur:20,color:"#FFEF00"}}}),this.Hint1.animate([{opacity:1}],{duration:.8,delay:.2,join:!0}),this.Hint2.animate([{opacity:1}],{duration:.8,delay:.4,join:!0})}hide_(){this.animate([{opacity:0}],{duration:.5,join:!0}).once(_.COMPLETED,()=>this.visible=!1)}}class Q extends w{constructor(){super({x:0,y:0,width:i.bw,height:i.bh,visible:!1,zIndex:991}),this.Title=new y({x:i.bw/2,y:i.bh*2/7,around:"center",text:"",fontSize:128,fontFamily:"HYBeiBingYang-W",scale:.5,opacity:0}),this.Hint1=new I(i.bw/2,i.bh*9/14-12,"center","#444",16).$append("按").$append("空格键",3,void 0,void 0,"bold").$append("重新开始"),this.Hint1.opacity=0,this.Hint2=new I(i.bw/2,i.bh*9/14+12,"center","#444",16).$append("按").$append("回车键",3,void 0,void 0,"bold").$append("返回菜单"),this.Hint2.opacity=0,this.add([this.Title,this.Hint1,this.Hint2]),this.init_=this.init_.bind(this)}relocate_(t){this.Title.x=t.width/2,this.Title.y=t.height*2/7}async init_(){await Promise.all([this.#t(),this.#s()])}async#t(){await i.fontInitializer("HYBeiBingYang-W","./assets/fonts/HYBeiBingYang-W")}async#s(){await Promise.all([i.ImageInitializer("GL.jpg","./assets/img/GL.jpg"),i.ImageInitializer("DL.jpg","./assets/img/DL.jpg")])}show_(){this.visible=!0,this.relocate_({width:i.bw,height:i.bh}),this.Title.animate([{scale:1,opacity:1}],{duration:.4,join:!0}),this.Hint1.animate([{opacity:1}],{duration:.8,delay:.2,join:!0}),this.Hint2.animate([{opacity:1}],{duration:.8,delay:.4,join:!0})}hide_(){this.Title.animate([{scale:.3,opacity:0}],{duration:.3,join:!0});const t=[[{opacity:0}],{duration:.5,join:!0}];this.Hint1.animate(...t),this.Hint2.animate(...t).once(_.COMPLETED,()=>this.visible=!1)}win_(){this.Title.text=" You Win! ",this.#e("leafer://GL.jpg",75),this.#n("#FFEF00"),this.show_()}fail_(){this.Title.text=" FAIL ",this.#e("leafer://DL.jpg",-50),this.#n("#474746"),this.show_()}#e(t,s){this.Title.fill={type:"image",url:t,offset:{y:s}}}#n(t){this.Title.shadow={x:0,y:0,blur:25,spread:15,color:t}}}class J extends y{constructor(){super({x:12,y:i.bh-24,fontSize:12,fill:"#777",text:"FPS: --"})}relocate_(t){t.height!==t.old.height&&(this.y=t.height-24)}assign_(t){isNaN(t)&&(t="--"),this.text="FPS: "+t}}class tt extends O{constructor(){super({points:[0,i.bh,0,0,i.bw,0,i.bw,i.bh,i.bw-i.ENV.paddingSide,i.bh,i.bw-i.ENV.paddingSide,i.ENV.paddingTop,i.ENV.paddingSide,i.ENV.paddingTop,i.ENV.paddingSide,i.bh],fill:"#E85B5B87"})}relocate_(t){this.points=[0,t.height,0,0,t.width,0,t.width,t.height,t.width-i.ENV.paddingSide,t.height,t.width-i.ENV.paddingSide,i.ENV.paddingTop,i.ENV.paddingSide,i.ENV.paddingTop,i.ENV.paddingSide,t.height]}}class S extends w{alarm;remaining=i.ENV.timeLimit;animatingFlag=!1;constructor(){super({x:15,y:15}),this.Icon=new D({path:"M511.488 0C228.864 0 0 229.376 0 512s228.864 512 511.488 512C794.624 1024 1024 794.624 1024 512s-229.376-512-512.512-512z m21.76 556.416V219.52H438.912v392.32h1.472l243.84 140.8 47.296-81.728-198.144-114.432zM512 921.6A409.472 409.472 0 0 1 102.4 512c0-226.304 183.296-409.6 409.6-409.6 226.304 0 409.6 183.296 409.6 409.6 0 226.304-183.296 409.6-409.6 409.6z",x:0,y:0,scale:.015625,fill:"#262626"}),this.IconG=new w({x:0,y:0,width:16,height:16,origin:"center",children:[this.Icon]}),this.Text=new y({x:20,y:0,fontSize:16,lineHeight:16,text:"3:00",fill:"#262626"}),this.add([this.IconG,this.Text])}reset_(){this.remaining=i.ENV.timeLimit,this.animatingFlag=!1,this.Text.text=S.toMSString_(i.ENV.timeLimit),this.Text.fontWeight="normal",this.Text.fill=this.Icon.fill="#262626"}start_(){this.alarm=c.newInterval(this.#t.bind(this),1e3)}stop_(){c.cancelInterval(this.alarm),this.animatingFlag&&(this.animatingFlag=!1,this.IconG.killAnimate())}static toMS_(t){return[b(t/60),t%60]}static toMSString_(t){const s=t%60;return`${b(t/60)}:${s<10?"0"+s:s}`}#t(){--this.remaining<0||(this.Text.text=S.toMSString_(this.remaining),!this.animatingFlag&&this.remaining<=15&&(this.animatingFlag=!0,this.IconG.animate([{style:{rotation:35,y:0},duration:.1},{style:{rotation:-35,y:-3},duration:.1},{style:{rotation:25,y:-3},duration:.1},{style:{rotation:-25,y:0},duration:.1}],{loop:!0,loopDelay:.6,join:!0}),this.Icon.fill=this.Text.fill="#44C2F1",this.Text.fontWeight="bold"),this.remaining<=0&&i.gameOver(!0))}}class E extends w{v=0;constructor(){super({x:i.bw/2-120,y:0}),this.Panel=new D({path:`m -120 0
  h 10
  a 20 15 0 0 1 20 15
  v 35
  a 15 18 0 0 0 15 18
  h 150
  a 15 18 0 0 0 15 -18
  v -35
  a 20 15 0 0 1 20 -15
  h 10
  Z`,x:120,y:0,fill:"#777A"}),this.Integer=new y({x:-i.bw,y:7,fontSize:40,fill:"#FFF",text:"-",fontFamily:"HYDiSiKe-U"}),this.Decimal=new y({x:-i.bw,y:15,fontSize:32,fill:"#DDD",text:"--",fontFamily:"HYDiSiKe-U"}),this.add([this.Panel,this.Integer,this.Decimal]),this.init_=this.init_.bind(this)}reset_(){this.assign_(0)}relocate_(t){t.width!==t.old.width&&(this.cx=t.width/2,this.#e())}async init_(){await this.#t()}async#t(){await i.fontInitializer("HYDiSiKe-U","./assets/fonts/HYDiSiKe-U"),this.#e()}assign_(t){return this.v=Math.round(t*10),this.#e(),E.stringify_(this.v)}delta_(t){const s=this.v;return this.v+=Math.round(t*10),this.#e(),E.stringify_(this.v-s)}tip_(t){const[s,e,n]=this.#s(),r=new y({x:a.cx+s,y:a.oy,around:"center",text:"+"+t,fill:"#FFEF00",stroke:"#33333333",fontSize:20,fontFamily:"HYDiSiKe-U",opacity:.9,shadow:{x:1,y:1,blur:10,color:"gray"},animation:{keyframes:[{style:{opacity:.9,fontSize:24},duration:.3},{style:{opacity:0,fontSize:25},duration:.4}],join:!0}});r.render_(),r.animate([{offsetX:e}],{duration:.45,easing:"sine-out",join:!0}),r.animate([{style:{offsetY:-12},duration:.12,easing:"quad-out"},{style:{offsetY:n},duration:.28,easing:"quad-in-out"}],{join:!0}),c.newTimeout(function(){r.destroy()},600)}#s(){const t=.7*a.vx*600/i.ENV.actUnitInterval;let s=Math.random()>=.5?1:-1,e=(10+Math.random()*20)*s,n=(40+Math.random()*20)*s,r=(Math.random()-.4)*24;const l=e+n+t;return(a.cx+l<=i.ENV.paddingSide||a.cx+l>=i.bw-i.ENV.paddingSide)&&(e*=-1,n*=-1),[e+t/2,n+t/2,r]}#e(){this.Integer.text=b(this.v/10),this.Decimal.text="."+this.v%10,this.Integer.x=(240-this.Integer.w-this.Decimal.w)/2,this.Decimal.x=this.Integer.ox}static stringify_(t){return`${b(t/10)}.${t%10}`}}class et extends P{vxMax;vyMax;vx;vy;availZone=[80,40,0,40];constructor(){super({width:120,height:25,fill:"#32CD79"})}reset_(){this.vxMax=6,this.vyMax=2.8,this.vx=0,this.vy=0,this.cx=i.bw/2,this.y=i.bh-140}frameLoop(t){this.vx=this.vy=0,(u.isHold("KeyW")||u.isHold("ArrowUp"))&&(this.vy-=this.vyMax*t),(u.isHold("KeyS")||u.isHold("ArrowDown"))&&(this.vy+=this.vyMax*t),(u.isHold("KeyA")||u.isHold("ArrowLeft"))&&(this.vx-=this.vxMax*t),(u.isHold("KeyD")||u.isHold("ArrowRight"))&&(this.vx+=this.vxMax*t),this.x+=this.vx,this.y+=this.vy,H.borderDetect(h,{paddings:this.availZone})}}class it{length=8;dotRadius=5.5;loopIdx=0;dotIdx=-1;dots=new Map;activeAnimations=new Map;framesInterval=5;constructor(){for(let t=0;t<this.length;++t)this.dots.set(t,new N({x:-100,y:-100,width:this.dotRadius*2,height:this.dotRadius*2,around:"center",fill:"#FF4500BA",visible:!1}))}render(){for(let t of this.dots.values())t.render_()}prepare(){i.ENV.actUnitInterval>=25?this.framesInterval=at(94/i.ENV.actUnitInterval):this.framesInterval=b(94/i.ENV.actUnitInterval)}frameLoop(t){if(this.loopIdx=(this.loopIdx+1)%this.framesInterval,this.loopIdx===0){const s=this.dotIdx=(this.dotIdx+1)%this.length,e=this.dots.get(s);if(e.w=e.h=this.dotRadius*2,e.opacity=1,e.x=a.cx,e.y=a.cy,e.visible=!0,this.activeAnimations.has(s)){const r=this.activeAnimations.get(s);r.off(_.COMPLETED),d.killAnimate(r),this.activeAnimations.delete(s)}const n=e.animate([{opacity:1,width:this.dotRadius*2,height:this.dotRadius*2},{opacity:.3,width:5,height:5}],{duration:i.ENV.stdUnitInterval*this.framesInterval*this.length/t/1e3,easing:"linear"});n.on(_.COMPLETED,()=>{this.activeAnimations.delete(s),e.visible=!1,e.w=e.h=this.dotRadius*2,e.opacity=1}),this.activeAnimations.set(s,n)}}}class st extends N{vx;ax;ay;timeDivisor=1;constructor(){super({width:20,height:20,fill:"#20A8D7"}),this.trailing=new it}reset_(){this.vx=(Math.random()*1.9+1.6)*(Math.random()>.5?1:-1),this.vy=3.5,this.ax=127e-6,this.ay=143e-6,this.cx=i.bw/2,this.cy=i.bh/4}render_(){this.trailing.render(),d.add(this)}prepare_(){this.trailing.prepare()}frameLoop_(t){m.remaining>=70&&m.remaining<160&&(this.vx*=(1+this.ax)**t,this.vy*=(1+this.ay)**t,this.ax*=.99987,this.ay*=.99987),this.x+=this.vx*t,this.y+=this.vy*t,H.borderDetect(this,{bounce:!0,paddings:[0,0,-this.h*3,0],callbacks:[null,null,i.gameOver,null]}),this.trailing.frameLoop(this.timeDivisor)}}const nt=Math.abs,at=Math.ceil,b=Math.floor;let V;function T(o){V=o}const $=document.querySelector("#loading");k();const d=new Y({view:document.querySelector("canvas"),fill:"#EFF",pointer:{preventDefaultMenu:!0}}),i=new W({refreshRate:60,actUnitInterval:16.7,stdUnitInterval:16.7,fixedStep:16.7,maxStepPerFrame:10,paddingTop:80,paddingSide:40,timeLimit:180}),H=new K,c=new X({minInterval:0,autoHandleFPS:!0}),f=new q,x=new Z,p=new Q,M=new J,L=new tt,m=new S,v=new E,h=new et,a=new st;$.addEventListener("dragstart",o=>o.preventDefault());let F=0;f.render_("#FFF",1,.7,.4);rt();i.renderAll();requestAnimationFrame(ot);c.newInterval(()=>M.assign_(c.FPS),400);i.initializeAll().then(()=>i.state("init1")).catch(o=>console.error(`Initialization failed...
`,o));function rt(){m.reset_(),h.reset_(),a.reset_()}function ot(o){T(o),R(o)}function R(o){const t=o-V;T(o),c.timeDetect(o),i.at("init1")?i.measureRefreshRate(t/i.ENV.stdUnitInterval):i.at("init2")?(a.prepare_(),i.state("almost-prepared")):i.at("almost-prepared")&&(i.state("prepared"),i.loadingFadeOut(),i.menu(!1));let s=1;if(i.at("playing"))for(F+=Math.min(t,500),a.timeDivisor=Math.min(b(F/i.ENV.fixedStep),i.ENV.maxStepPerFrame);F>=i.ENV.fixedStep&&s<=i.ENV.maxStepPerFrame;){F-=i.ENV.fixedStep,++s;const e=i.ENV.fixedStep/i.ENV.stdUnitInterval;if(a.frameLoop_(e),h.frameLoop(e),H.collisionDetect()&&a.vy<0){const n=Math.sqrt(a.vx**2+a.vy**2),r=Math.log2(n)+1/Math.cos(Math.PI/20*n),l=nt(h.cx-a.cx),g=Math.cos(Math.PI/h.w*2*l)+.5;v.tip_(v.delta_(.4*r+.16*g))}}requestAnimationFrame(R)}document.addEventListener("visibilitychange",function(){document.hidden?i.pause():i.resume()});d.on(U.RESIZE,function(o){f.relocate_(o),x.relocate_(o),p.relocate_(o),M.relocate_(o),L.relocate_(o),v.relocate_(o)});d.on(A.HOLD,function(o){o.code==="Semicolon"&&M.toggle_()});d.on(A.UP,function(o){switch(o.code){case"Space":i.at("prepared")?(i.state("playing"),m.start_(),i.start()):i.at("over")&&(i.resetMain(),i.state("playing"),m.start_());break;case"Enter":i.at("over")&&(i.state("prepared"),p.hide_(),i.menu());break}});
//# sourceMappingURL=index-C4xfbYT4.js.map
